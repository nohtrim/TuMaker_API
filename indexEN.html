<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Rekam 2016 | Utilizando la API de Tumaker</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.6 -->
  <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
  <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
  
  <link rel="stylesheet" href="css/prettify.css">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<!-- ADD THE CLASS layout-top-nav TO REMOVE THE SIDEBAR. -->
<body class="hold-transition skin-blue layout-top-nav">
<div class="wrapper">

  <header class="main-header">
    <nav class="navbar navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <a href="../../index2.html" class="navbar-brand"><b>Rekam</b>2016</a>
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
            <i class="fa fa-bars"></i>
          </button>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="https://github.com/nohtrim/TuMaker_API" target="_blank"><i class="fa fa-github"></i> Source Code</a></li>
            <li><a href="https://github.com/nohtrim" target="_blank"><i class="fa fa-linkedin-square"></i> Gorka Perez</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-flag"></i> Language <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li><a href="index.html">Spanish</a></li>
                <li><a href="indexEN.html">English</a></li>
              </ul>
            </li>
          </ul>
        </div>
        <!-- /.navbar-collapse -->
      </div>
      <!-- /.container-fluid -->
    </nav>
  </header>
  <!-- Full Width Column -->
  <div class="content-wrapper">
    <div class="container">
      <!-- Content Header (Page header) -->
      <section class="content-header">
        <h1>
          Rekam
          <small>Testing the TuMaker API</small>
        </h1>
      </section>

      <!-- Main content -->
      <section class="content">
        <div class="row">
          <div class="col-md-12">
            <!-- Custom Tabs -->
            <div class="nav-tabs-custom">
              <ul class="nav nav-tabs">
                <li class="active"><a href="#tab_1" data-toggle="tab">Basic</a></li>
                <li><a href="#tab_2" data-toggle="tab">Html</a></li>
                <li><a href="#tab_3" data-toggle="tab">JQuery / Ajax</a></li>
              </ul>
              <div class="tab-content">
                <div class="tab-pane active" id="tab_1">

                  <!-- /.box-header -->
                  <div class="box-body">
                    <blockquote>
                      <p><strong>TuMaker</strong> is more than a <strong>3D printer</strong> company: it is a company which provides added value and expert companionship to educate and help companies, schools, collectives or anyone use an ecosystem of personal creation that is affordable and high quality. TuMaker works hard for this personal creation to be a new opportunity to develop new ideas and individually create things that were unthinkable until recently.</p>
                    </blockquote>
                    
                    <p>We will test the TuMaker API, and for that we shall upload a <strong>GCODE</strong>. In order to accomplish this, we will need to connect to a user, create a model and upload the aforementioned file to the model.</p> 
                    <p>You can try it out yourself! Download the GCODE example file by clicking <a href="mount_export.gcode" download><strong>here</strong></a>.</p>
                    
                    <div class="row">
                      <div class="col-md-12">
                        <div class="box-body">
                          <div class="row">
                            <form id='subirFichero' enctype="multipart/form-data" method="post" name="subirFichero">
                              <div class="col-xs-3">
                                <input type="text" class="form-control" id="nombre" name="nombreFichero" placeholder="Enter a name">
                              </div>
                              <div class="col-xs-4">
                                <input id="file" class="form-control" type="file" name="files[]" multiple="multiple">
                              </div>
                              <div class="col-xs-5">
                                <button id="enviar" class="btn btn-primary btn-block btn-flat"><i class="fa fa-upload"></i> Upload File</button>
                              </div>
                            </form>
                          </div>
                          <hr>
                          
                          <div class="box box-primary">
                            <div class="box-header with-border">
                              <h3 class="box-title">Debug</h3>
                
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">
                              <div id="debug"></div>
                            </div>
                            <!-- /.box-body -->
                          </div>

                        </div>
                      </div>
                    </div>
                    
                  </div>
                  
                </div>
                <!-- /.tab-pane -->
                <div class="tab-pane" id="tab_2">
                  
<p><strong>index.html</strong></p>
<pre class="prettyprint linenums">
&lt;div class="row"&gt;
  &lt;div class="col-md-12"&gt;
    &lt;div class="box-body"&gt;
      &lt;div class="row"&gt;
        &lt;form id='subirFichero' enctype="multipart/form-data" method="post" name="subirFichero"&gt;
          &lt;div class="col-xs-3"&gt;
              &lt;input type="text" class="form-control" id="nombre" name="nombreFichero" placeholder="Enter a name"&gt;
            &lt;/div&gt;
            &lt;div class="col-xs-4"&gt;
              &lt;input id="file" class="form-control" type="file" name="files[]" multiple="multiple"&gt;
            &lt;/div&gt;
            &lt;div class="col-xs-5"&gt;
              &lt;button id="enviar" class="btn btn-primary btn-block btn-flat"&gt;&lt;i class="fa fa-upload"&gt;&lt;/i&gt; Upload File&lt;/button&gt;
          &lt;/div&gt;
        &lt;/form&gt;
      &lt;/div&gt;
      &lt;hr&gt;

      &lt;div class="box box-primary"&gt;
      &lt;div class="box-header with-border"&gt;
      &lt;h3 class="box-title"&gt;Debug&lt;/h3&gt;
      
      &lt;/div&gt;
      &lt;div class="box-body"&gt;
      &lt;div id="debug"&gt;&lt;/div&gt;
      &lt;/div&gt;
      &lt;/div&gt;

    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
</pre>

                </div>
                <!-- /.tab-pane -->
                <div class="tab-pane" id="tab_3">
<p><strong>js/funciones.js</strong></p>
<pre class="prettyprint linenums">
$(document).ready(function() {
  
  $('&lt;p/&gt;').text("Plugin initialised correctly.").appendTo('#debug').addClass('text-muted');

  // When clicking on the "Upload File" button this event will be executed
  $('#subirFichero').submit(function(event) {
    event.preventDefault();

    // The values of the form will be received and saved in variables
    var nameInput = $('#nombre').val();
    var fileInput = document.getElementById('file');
    var file = fileInput.files[0];
    var formData = new FormData();
    formData.append('file', file);
    
    var size = file.size;

    // Make sure the user has introduced valid values
    if (file.name.length < 1) {
      alert('Select a file');
    } else if (nameInput.length < 1) {
      alert('Enter a name');
    } else if(size > 5242880) {
      alert("The file is too big.");
    } else {

      // If you do not have any value in the cookie ( the jquery.cookie.js library ) we will connect to the API
      if ($.cookie('el_cookie') == undefined) {
      
        // Method used to request a Token from the API
        /* The process.env variables contain the values given to you by TuMaker. Take into account 
           this is just a small example and writing the passwords directly on the code is unsafe when 
           coding on the server side (PHP, NodeJSâ€¦) or sending the values through a form */
        $.ajax({
          url: 'https://dev.api.tumaker.life/auth/token/',
          type: 'post',
          contentType: 'application/x-www-form-urlencoded',
          data: {
            username: process.env.DB_USER,
            password: process.env.DB_PASS,
            client_id: process.env.CLIENT_ID,
            grant_type: "password"
          },
        
          success: function (data) {
            
            // The cookie containing the Token is saved for 6 hours
            token = data.access_token;
            
            var date = new Date();
            var minutes = 360;
            date.setTime(date.getTime() + (minutes * 60 * 1000));
            $.cookie('el_cookie', token, { expires: date });
              
          },
          // When complete the following function is run
          complete: function () {
            creando_modelo(); 
          }
        })
        .fail(function() {
          // If there is any kind of error during this process the message is shown in Debug
          $('&lt;p/&gt;').text("Error trying to login.").appendTo('#debug').addClass('text-red');
        });	
      
      // The model is created in this function
      } else{
        creando_modelo();
      }  
  
      // In this feature we created the model
      function creando_modelo(){
        event.preventDefault();
        
        // If there is no value in the cookie the connection to the API will be started
        if ($.cookie('el_cookie') == undefined) {
          $('&lt;p/&gt;').text("This function cannot be executed without being logged in.").appendTo('#debug').addClass('text-red');
        } else {
          
          $('&lt;p/&gt;').text("Creating model...").appendTo('#debug');
    
          $.ajax({
            url: 'https://dev.api.tumaker.life/api/models',
            type: 'post',
            data: {
              display_name: nameInput
            },
            // The Token is sent to the API to prove we have access
            beforeSend: function (xhr) {
              xhr.setRequestHeader('Authorization', 'bearer ' + $.cookie('el_cookie'));
            },
            
            // If everything works the code skuCode will be received and saved in a variable for future use
            success: function (data) {
                
              var sku = data.skuCode;
              formData.append('sku', sku);
              
              $('&lt;p/&gt;').text("Model created.").appendTo('#debug').addClass("text-green");
              console.log(JSON.stringify(data));
              
            },
            // Once the skuCode has been received the following function will be executed to upload the file
            complete: function () {
              subiendo_fichero(); 
            }
          })
          .fail(function() {
            $('&lt;p/&gt;').text("Error trying to create the model.").appendTo('#debug').addClass('text-red');
          });	
        }
      }        

      // Function used to upload the file
      function subiendo_fichero(){
      
        // Make sure the cookie is not empty and the skuCode has been received
        if (($.cookie('el_cookie') == undefined) && (formData.get(sku) == undefined)) {
          $('&lt;p/&gt;').text("Error, no tienes lo necesario para continuar.").appendTo('#debug');
        } else {
          
          // Load the XHR2
          var xhr = new XMLHttpRequest();
          
          $('&lt;p/&gt;').text("Uploading the fileâ€¦").appendTo('#debug');
          
          // Send the file which was saved at the beginning in (formData) and the skuCode along with the Token authorisation to the URL
          xhr.open('post', 'https://dev.api.tumaker.life/api/models/upload', true);
          xhr.setRequestHeader('Authorization', 'bearer ' + $.cookie('el_cookie'));
          xhr.send(formData);
          
          // The event controller will report whether everything worked correctly
          xhr.addEventListener('readystatechange', function(e) {
            if( this.readyState === 4) {
            
              if(xhr.statusText == 'CREATED'){
                console.log(xhr.statusText);
                $('&lt;p/&gt;').text('File uploaded successfully').appendTo('#debug').addClass("text-green");
              } else {
                console.log(xhr.statusText);
                $('&lt;p/&gt;').text("Error trying to upload the file.").appendTo('#debug').addClass('text-red');
              }
            }
          });
        }
      } 
    }
  });
});
</pre>
                </div>
                <!-- /.tab-pane -->
              </div>
              <!-- /.tab-content -->
            </div>
            <!-- nav-tabs-custom -->
            
            <div class="row">
              <div class="col-md-12">
                <div class="box box-solid">
                  <div class="box-header with-border">
      
                    <h3 class="box-title">Demo Notes</h3>
                  </div>
                  <!-- /.box-header -->
                  <div class="box-body">
                    <ul>
                      <li>The maximum file size for uploads in this demo is <strong>5 MB</strong></li>
                      <li>Only files <strong>(GCODE)</strong> are allowed in this demo (by default there is no file type restriction).</li>
                      <li>Built with the <a href="http://almsaeedstudio.com" target="_blank">AdminLTE-2.3.5</a> Template what includes <a href="http://getbootstrap.com/" target="_blank">Bootstrap</a> CSS framework.</li>
                      <li>Syntax Highlighter: <a href="http://www.sykot.com/tutorials/syntax-highlighter-google-code-prettify-bootstrap-3-x" target="_blank">Google Code Prettify</a></li>
                    </ul>
                  </div>
                  <!-- /.box-body -->
                </div>
                <!-- /.box -->
              </div>
              <!-- ./col -->
            </div>
            <!-- /.row -->
          </div>
          <!-- /.col -->
        </div>
      </section>
      <!-- /.content -->
    </div>
    <!-- /.container -->
  </div>
  <!-- /.content-wrapper -->
  <footer class="main-footer">
    <div class="container">
      <div class="row">
        <div class="col-xs-5">
          Released under the <a href="http://www.opensource.org/licenses/MIT" target="_blank">MIT license</a>.
        </div>
        <div class="col-xs-4">
          <a href="http://tumaker.com/" target="_blank"><img src="dist/img/6959d8682451bfbce5c752dc37688450_400x400.png" height="100px" width="100px" class="user-image center" alt="User Image"></a>
        </div>
        <div class="col-xs-3">
          
        </div>
      </div>
    </div>
    <!-- /.container -->
  </footer>
</div>
<!-- ./wrapper -->

<!-- jQuery 2.2.3 -->
<script src="plugins/jQuery/jquery-2.2.3.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="bootstrap/js/bootstrap.min.js"></script>
<!-- FastClick -->
<script src="plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="dist/js/demo.js"></script>
<!-- Cookie -->
<script src="js/jquery.cookie.js"></script>
<!-- My Code-->
<script src="js/funciones.js"></script>
<!-- bs-prettify-->
<script src="js/prettify.js"></script>

<script>
  !function ($) {
    $(function(){
      window.prettyPrint && prettyPrint()
    })
  }(window.jQuery)
</script>
</body>
</html>
